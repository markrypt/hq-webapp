<header class="header">
  <div class="logo">
    <a href="/">
      <img src="/assets/logo/logo.png" alt="Markrypt Logo" class="logo-image">
      <span class="company-name"><span class="mark">Mark</span><span class="krypt">rypt</span></span>
    </a>
  </div>  <div class="header-controls">
    <div class="search-icon" aria-label="Search" onclick="initializeSearch()">
      <i class="fas fa-search"></i>
    </div>
    <div class="menu-icon" tabindex="0" aria-haspopup="true" aria-expanded="false" aria-label="Menu" onclick="toggleMenuDropdown()" onblur="closeMenuDropdown()">
      <i class="fas fa-bars"></i>
      <div class="menu-dropdown" id="menuDropdown">
        <div class="dropdown-title">Legal & Info</div>
        <a href="/privacy">Privacy Policy</a>
        <a href="/terms">Terms of Use</a>
        <a href="/cookies">Cookie Policy</a>
        <a href="/about">About Markrypt</a>
        <a href="/contact">Contact Us</a>
      </div>
    </div>
  </div>
</header>
<script>
  function initializeSearch() {
    console.log('🔍 Search icon clicked');
    
    // Function to try opening the search modal
    const tryOpenSearch = () => {
      if (window.searchManager && typeof window.searchManager.openSearchModal === 'function') {
        console.log('✅ Opening search modal');
        window.searchManager.openSearchModal();
        return true;
      }
      return false;
    };

    // First attempt to open search modal
    if (tryOpenSearch()) return;

    // Check if we need to load required scripts
    if (!window.SearchManager) {
      console.log('📦 SearchManager not found, loading required scripts...');
      
      // Create a helper function to dynamically load a script
      const loadScript = (src) => {
        return new Promise((resolve, reject) => {
          // Check if script is already loaded
          const existingScript = document.querySelector(`script[src="${src}"]`);
          if (existingScript) {
            resolve();
            return;
          }
          
          const script = document.createElement('script');
          script.src = src;
          script.onload = () => resolve();
          script.onerror = (err) => reject(err);
          document.head.appendChild(script);
        });
      };
      
      // Determine base path for assets
      const basePath = window.location.pathname.includes('/category/') ? '../' : '';
      
      // Load scripts in sequence
      loadScript(`${basePath}assets/js/global-products-loader.js`)
        .then(() => loadScript(`${basePath}assets/js/search-manager.js`))
        .then(() => loadScript(`${basePath}assets/js/search-init.js`))
        .then(() => {
          console.log('📦 All search scripts loaded, initializing...');
          if (!window.searchManager && typeof SearchManager === 'function') {
            window.searchManager = new SearchManager();
            return window.searchManager.init();
          }
        })
        .then(() => {
          console.log('✅ SearchManager ready, opening modal...');
          if (window.searchManager && typeof window.searchManager.openSearchModal === 'function') {
            window.searchManager.openSearchModal();
          }
        })
        .catch(err => {
          console.error('❌ Failed to load search scripts:', err);
        });
      
      return;
    }
    
    // If SearchManager exists but searchManager instance doesn't exist
    if (!window.searchManager && typeof SearchManager === 'function') {
      console.log('🔧 Creating new SearchManager instance...');
      window.searchManager = new SearchManager();
      window.searchManager.init().then(() => {
        console.log('✅ SearchManager initialized, opening modal...');
        window.searchManager.openSearchModal();
      }).catch(err => {
        console.error('❌ Failed to initialize search:', err);
      });
      return;
    }
    
    // If searchManager exists but isn't ready, wait for initialization
    if (window.searchManager) {
      console.log('⏳ Waiting for SearchManager initialization...');
      setTimeout(tryOpenSearch, 500);
      return;
    }
  }
</script>

