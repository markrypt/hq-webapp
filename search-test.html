<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search Functionality Test</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #1e90ff;
    }
    .test-box {
      background: #f5f9ff;
      border: 1px solid #d0e0ff;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    button {
      background: #1e90ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #0070e0;
    }
    .result {
      background: #f0f0f0;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
      margin-top: 15px;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Search Functionality Test</h1>
  
  <div class="test-box">
    <h2>1. Test Component Loader</h2>
    <p>This test checks if components-loader.js correctly loads and initializes search functionality.</p>
    <button onclick="testComponentLoader()">Run Test</button>
    <div id="componentLoaderResult" class="result">Results will appear here...</div>
  </div>

  <div class="test-box">
    <h2>2. Test Search Functionality</h2>
    <p>This test performs a search query and displays results.</p>
    <input type="text" id="searchQuery" placeholder="Enter search term..." style="padding:8px; width:300px;">
    <button onclick="testSearch()">Search</button>
    <div id="searchResult" class="result">Results will appear here...</div>
  </div>
  
  <div class="test-box">
    <h2>3. Test Search Initialization</h2>
    <p>This test checks if SearchManager is properly initialized.</p>
    <button onclick="testSearchInit()">Run Test</button>
    <div id="searchInitResult" class="result">Results will appear here...</div>
  </div>
  
  <div id="header-placeholder"></div>
  <div id="navigation-placeholder"></div>
  
  <!-- Only load the components-loader.js script -->
  <script src="assets/js/components-loader.js"></script>
  
  <script>
    // Test functions
    function testComponentLoader() {
      const result = document.getElementById('componentLoaderResult');
      let output = [];
      
      // Check if scripts were loaded
      output.push(`SearchManager class loaded: ${typeof SearchManager !== 'undefined' ? 'Yes' : 'No'}`);
      output.push(`initializeSearch function exists: ${typeof initializeSearch !== 'undefined' ? 'Yes' : 'No'}`);
      output.push(`searchManager instance exists: ${window.searchManager ? 'Yes' : 'No'}`);
      
      // Check if header was loaded
      const header = document.getElementById('header-placeholder');
      output.push(`Header element exists: ${header ? 'Yes' : 'No'}`);
      output.push(`Header has content: ${header && header.innerHTML.trim() !== '' ? 'Yes' : 'No'}`);
      
      // If search manager exists, show product count
      if (window.searchManager) {
        output.push(`Total products loaded: ${window.searchManager.productsData.length}`);
      }
      
      result.textContent = output.join('\n');
    }
    
    function testSearch() {
      const result = document.getElementById('searchResult');
      const query = document.getElementById('searchQuery').value.trim();
      
      if (!query) {
        result.textContent = 'Please enter a search term';
        return;
      }
      
      if (!window.searchManager) {
        result.textContent = 'SearchManager not initialized yet. Try running the initialization test first.';
        return;
      }
      
      try {
        const searchResults = window.searchManager.search(query);
        const output = [];
        
        output.push(`Found ${searchResults.length} results for "${query}":`);
        
        if (searchResults.length > 0) {
          searchResults.slice(0, 10).forEach((item, index) => {
            output.push(`${index + 1}. ${item.title} (${item.category})`);
          });
          
          if (searchResults.length > 10) {
            output.push(`...and ${searchResults.length - 10} more results.`);
          }
        } else {
          output.push('No results found.');
        }
        
        result.textContent = output.join('\n');
      } catch (error) {
        result.textContent = `Error performing search: ${error.message}`;
      }
    }
    
    function testSearchInit() {
      const result = document.getElementById('searchInitResult');
      let output = [];
      
      // Try to initialize search if not already done
      if (!window.searchManager && typeof SearchManager !== 'undefined') {
        output.push('SearchManager class found but not initialized. Initializing now...');
        
        window.searchManager = new SearchManager();
        window.searchManager.init()
          .then(() => {
            const updatedOutput = [
              ...output,
              'SearchManager initialized successfully!',
              `Total products loaded: ${window.searchManager.productsData.length}`,
              'Categories represented:',
              ...Object.entries(getCategoryCounts()).map(([category, count]) => `- ${category}: ${count} products`)
            ];
            result.textContent = updatedOutput.join('\n');
          })
          .catch(err => {
            output.push(`Failed to initialize SearchManager: ${err.message}`);
            result.textContent = output.join('\n');
          });
      } else if (window.searchManager) {
        output.push('SearchManager already initialized!');
        output.push(`Total products loaded: ${window.searchManager.productsData.length}`);
        
        // Get category distribution
        output.push('Categories represented:');
        Object.entries(getCategoryCounts()).forEach(([category, count]) => {
          output.push(`- ${category}: ${count} products`);
        });
        
        result.textContent = output.join('\n');
      } else {
        output.push('SearchManager class not found. Components-loader.js might not have loaded search scripts yet.');
        output.push('Wait a few seconds and try again, or check the console for errors.');
        result.textContent = output.join('\n');
      }
    }
    
    // Helper function to get product counts by category
    function getCategoryCounts() {
      if (!window.searchManager || !window.searchManager.productsData) {
        return {};
      }
      
      const counts = {};
      window.searchManager.productsData.forEach(product => {
        if (product.category) {
          counts[product.category] = (counts[product.category] || 0) + 1;
        }
      });
      
      return counts;
    }
    
    // Auto-run tests after a short delay
    setTimeout(() => {
      testComponentLoader();
      testSearchInit();
    }, 2000);
  </script>
</body>
</html>
